{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "nvidia_driver_version": {
            "type": "string",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
            "default": "580.76.05"
        },
        "nvidia_repo_url": {
            "type": "string",
            "format": "uri",
            "default": "https://developer.download.nvidia.com/compute/cuda/repos/debian12/x86_64/"
        },
        "lxc_configs": {
            "type": "object",
            "additionalProperties": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "minLength": 1
                    },
                    "memory_mb": {
                        "type": "integer",
                        "minimum": 512
                    },
                    "cores": {
                        "type": "integer",
                        "minimum": 1
                    },
                    "template": {
                        "type": "string",
                        "minLength": 1
                    },
                    "storage_pool": {
                        "type": "string",
                        "minLength": 1
                    },
                    "storage_size_gb": {
                        "type": "integer",
                        "minimum": 10
                    },
                    "network_config": {
                        "type": "string",
                        "minLength": 1
                    },
                    "features": {
                        "type": "string",
                        "minLength": 1
                    },
                    "gpu_assignment": {
                        "type": "string",
                        "pattern": "^([0-9]+(,[0-9]+)*|none)$",
                        "default": "none"
                    },
                    "vllm_model": {
                        "type": "string",
                        "minLength": 1
                    },
                    "vllm_tensor_parallel_size": {
                        "type": "integer",
                        "minimum": 1,
                        "default": 1
                    },
                    "vllm_max_model_len": {
                        "type": "integer",
                        "minimum": 64,
                        "default": 128
                    },
                    "vllm_kv_cache_dtype": {
                        "type": "string",
                        "enum": [
                            "auto",
                            "fp8",
                            "fp16"
                        ],
                        "default": "auto"
                    },
                    "vllm_shm_size": {
                        "type": "string",
                        "pattern": "^[0-9]+[mg]$",
                        "default": "8g"
                    },
                    "vllm_gpu_count": {
                        "type": "integer",
                        "minimum": 1,
                        "default": 1
                    },
                    "vllm_api_port": {
                        "type": "integer",
                        "minimum": 1024,
                        "maximum": 65535,
                        "default": 8000
                    },
                    "vllm_gpu_memory_utilization": {
                        "type": "number",
                        "minimum": 0.0,
                        "maximum": 1.0,
                        "default": 0.8
                    },
                    "vllm_dtype": {
                        "type": "string",
                        "enum": [
                            "float16",
                            "bfloat16",
                            "float32"
                        ],
                        "default": "float16"
                    },
                    "vllm_attention_backend": {
                        "type": "string",
                        "enum": [
                            "FLASHINFER",
                            "XFORMERS",
                            "TORCH"
                        ],
                        "default": "FLASHINFER"
                    },
                    "vllm_nccl_so_path": {
                        "type": "string",
                        "minLength": 1,
                        "default": "/root/.config/vllm/nccl/cu13/libnccl.so"
                    }
                },
                "required": [
                    "name",
                    "memory_mb",
                    "cores",
                    "template",
                    "storage_pool",
                    "storage_size_gb",
                    "network_config",
                    "features"
                    // Removed vllm_model and vllm_api_port from required as they are not needed for all container types (e.g., llamacpp)
                ]
            }
            // Optional: Add patternProperties for stricter key validation (e.g., keys must be numeric strings)
            // "patternProperties": {
            //   "^[0-9]+$": {
            //     "type": "object"
            //     // ... (properties definition can be repeated here or rely on additionalProperties)
            //   }
            // }
        }
    },
    "required": [
        "nvidia_driver_version",
        "nvidia_repo_url",
        "lxc_configs"
    ]
}